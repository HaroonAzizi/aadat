"use strict";(self.webpackChunkaadat=self.webpackChunkaadat||[]).push([[210],{591:(e,t,s)=>{s.r(t),s.d(t,{default:()=>f});var a=s(43),r=s(972),n=s(53),i=s(848),d=s(951),c=s(66),o=s(580),l=s(579);const h=e=>{let{habitId:t,userId:s}=e;const[r,n]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0);(0,a.useEffect)((()=>{(async()=>{const e=new Date,a=new Date;a.setDate(a.getDate()-365);const{data:r,error:i}=await d.N.from("habit_entries").select("completed_at").eq("habit_id",t).eq("user_id",s).gte("completed_at",a.toISOString()).lte("completed_at",e.toISOString());i?console.error("Error fetching entries:",i):(n(r||[]),c(!1))})()}),[t,s]);if(i)return(0,l.jsx)("div",{children:"Loading graph..."});const o=(()=>{const e=[],t=new Date;for(let s=365;s>=0;s--){const a=new Date;a.setDate(t.getDate()-s);const n=a.toISOString().split("T")[0],i=r.filter((e=>e.completed_at===n)).length;e.push({date:n,count:i})}return e})();return(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:o.map(((e,t)=>{return(0,l.jsx)("div",{className:"w-3 h-3 rounded-sm ".concat((s=e.count,0===s?"bg-gray-100":1===s?"bg-green-200":2===s?"bg-green-400":"bg-green-600")),title:"".concat(e.date,": ").concat(e.count," check-ins")},t);var s}))})},m=e=>{let{habitId:t,userId:s,onCheckIn:r}=e;const[n,c]=(0,a.useState)(!1),o=async e=>{try{const{data:t,error:s}=await d.N.from("habit_entries").select("completed_at").eq("habit_id",e).order("completed_at",{ascending:!1});if(s)throw s;let a=0;const r=new Date;r.setHours(0,0,0,0);for(let e=0;e<t.length;e++){const s=new Date(t[e].completed_at),n=new Date(r);if(n.setDate(r.getDate()-e),s.getTime()!==n.getTime())break;a++}const{error:n}=await d.N.from("habits").update({current_streak:a,longest_streak:d.N.raw("GREATEST(longest_streak, ?)",[a])}).eq("id",e);if(n)throw n}catch(t){console.error("Error updating streak:",t)}};return(0,l.jsx)(i.A,{onClick:async()=>{c(!0);try{const e=(new Date).toISOString().split("T")[0],{data:a}=await d.N.from("habit_entries").select("id").eq("habit_id",t).eq("completed_at",e).single();if(!a){const{error:a}=await d.N.from("habit_entries").insert([{habit_id:t,user_id:s,completed_at:e}]);if(a)throw a;await o(t)}r()}catch(e){console.error("Error checking in:",e)}finally{c(!1)}},isLoading:n,variant:"primary",className:"mt-2 text-white bg-green-600 px-2 py-1 rounded hover:bg-green-700",children:"Check In Today"})},g=e=>{let{showForm:t,setShowForm:s}=e;const[r,g]=(0,a.useState)(""),{habits:x,loading:u,error:b,refreshHabits:p}=(0,n.L)(),{user:j}=(0,c.A)();return u?(0,l.jsx)("div",{children:"Loading habits..."}):b?(0,l.jsxs)("div",{className:"text-red-600",children:["Error loading habits: ",b]}):j?(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[t&&(0,l.jsx)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:(0,l.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),j)try{await d.N.from("habits").insert([{name:r,user_id:j.id}]),p(),g(""),s(!1)}catch(b){console.error("Error adding habit:",b)}},className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"habitName",className:"block text-sm font-medium text-gray-700",children:"Habit Name"}),(0,l.jsx)("input",{type:"text",id:"habitName",value:r,onChange:e=>g(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-lg focus:border-blue-500 focus:ring-blue-500",required:!0})]}),(0,l.jsxs)("div",{className:"flex justify-center",children:[(0,l.jsx)(i.A,{className:"m-4 px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded",type:"button",variant:"secondary",onClick:()=>s(!1),children:"Cancel"}),(0,l.jsx)(i.A,{className:"m-4 px-4 py-2 text-white bg-green-600 rounded hover:bg-green-700",type:"submit",children:"Add Habit"})]})]})}),x&&x.length>0?(0,l.jsx)("div",{className:"space-y-6",children:x.map((e=>(0,l.jsxs)("div",{className:"border-b pb-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-medium",children:e.name}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,l.jsxs)("span",{className:"mr-4",children:["Current streak: ",e.current_streak," days"]}),(0,l.jsxs)("span",{children:["Best streak: ",e.longest_streak," days"]})]})]}),(0,l.jsx)(h,{habitId:e.id,userId:j.id}),(0,l.jsx)(m,{habitId:e.id,userId:j.id,onCheckIn:p})]},e.id)))}):(0,l.jsxs)("div",{className:"text-center py-6",children:[(0,l.jsx)("p",{className:"text-gray-500 mb-4",children:"No habits tracked yet"}),(0,l.jsx)(o.N_,{to:"/habits",children:(0,l.jsx)(i.A,{children:"Start Tracking a Habit"})})]})]}):null};var x=s(555),u=s(238),b=s(903),p=s(815);const j=e=>{let{showForm:t,setShowForm:s}=e;const{tasks:a,loading:r,error:n,addTask:d,updateTask:c,deleteTask:h}=(0,u.s)();if(r)return(0,l.jsx)("div",{children:"Loading tasks..."});if(n)return(0,l.jsxs)("div",{className:"text-red-600",children:["Error loading tasks: ",n]});const m=a.filter((e=>{if(!e.due_date)return!1;const t=(new Date).toISOString().split("T")[0];return e.due_date===t}));return(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[t&&(0,l.jsx)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:(0,l.jsx)(p.A,{onSubmit:async e=>{await d((0,x.A)((0,x.A)({},e),{},{completed:!1})),s(!1)},onCancel:()=>s(!1)})}),m.length>0?(0,l.jsx)(b.A,{tasks:m,onToggleComplete:(e,t)=>c(e,{completed:t}),onDeleteTask:h,onEditTask:()=>{}}):(0,l.jsxs)("div",{className:"text-center py-6",children:[(0,l.jsx)("p",{className:"text-gray-500 mb-4",children:"No tasks due today"}),(0,l.jsx)(o.N_,{to:"/tasks",children:(0,l.jsx)(i.A,{children:"Add a Task"})})]})]})};var w=s(814);const f=()=>{const[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1);return(0,l.jsxs)(r.A,{children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Habits"}),(0,l.jsx)(i.A,{className:"text-white bg-green-600 px-2 py-1 rounded hover:bg-green-700",onClick:()=>t(!0),children:"Add Habit"})]}),(0,l.jsx)(g,{showForm:e,setShowForm:t})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Today's Tasks"}),(0,l.jsx)(i.A,{className:"text-white bg-green-600 px-2 py-1 rounded hover:bg-green-700",onClick:()=>n(!0),children:"Add Task"})]}),(0,l.jsx)(j,{showForm:s,setShowForm:n})]})]}),(0,l.jsx)(w.A,{})]})}}}]);
//# sourceMappingURL=210.7e0f8791.chunk.js.map